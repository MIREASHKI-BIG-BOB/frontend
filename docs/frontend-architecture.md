# Архитектура фронтенда FIMEA

## 1. Обзор
- **Цель**: врачебный дашборд и лендинг для мониторинга КТГ и уведомлений.
- **Стек**: Vite + React 18 + TypeScript, Ant Design v5, Tailwind CSS, Recharts, react-grid-layout.
- **Формат сборки**: SPA с hash-based роутингом (для совместимости с простыми хостингами без серверного роутинга).

## 2. Структура проекта
```
src/
  App.tsx            # корневой компонент, маршрутизация и выбор layout
  main.tsx           # точка входа, ConfigProvider Ant Design
  components/        # переиспользуемые элементы лендинга и shell
  pages/             # страницы: лендинг и внутренние рабочие разделы
  widgets/           # крупные блоки дашборда (графики, карточки и т.д.)
  utils/             # NotificationService, AlertSystem и вспомогательные классы
  styles/            # общие стили и токены для виджетов
  theme.ts           # централизованная палитра и токены для Ant Design
  types/             # декларации типов (например, для CSS)
```
Дополнительно: `theme-old.ts` хранит предыдущий вариант темы, `index.css` подключает Tailwind и базовые стили.

## 3. Приложение и роутинг
- `App.tsx` управляет текущим маршрутом через `location.hash`.
- Лендинг (маршрут `#/`): компоненты `Hero`, `HowItWorks`, `Technologies`, `Trust`.
- Внутренние маршруты (`#/dashboard`, `#/patients`, `#/ctg`, `#/ai-analysis`, `#/settings`, `#/notifications`, `#/reports`).
- Все рабочие страницы отображаются внутри `AppLayout`, который обеспечивает общий shell (sider + top bar, управление меню, адаптация для мобильных).

## 4. Layout и навигация
- `AppLayout.tsx` содержит:
  - фиксированную боковую панель с группировкой пунктов меню и SubMenu для основных разделов;
  - хедер с кнопкой сворачивания, уведомлениями, профилем пользователя;
  - адаптивную логику: `isMobile` (<768 px) переключает ширину сайдера и скрывает подписи;
  - поддержку «режима редактирования» для виджетов в дашборде (через пропсы).
- Навигация осуществляется передачей обработчика `onNavigate`, который обновляет `location.hash`.

## 5. Страницы
- **Dashboard** (`pages/Dashboard.tsx`):
  - использует `Responsive` layout из `react-grid-layout` с предустановленными наборами конфигураций для разных брейкпоинтов;
  - хранит собственное состояние виджетов (настройки, режим редактирования, имитация записи данных);
  - использует `NotificationService` для отображения уведомлений при сохранении/сбросе раскладки;
  - виджеты собираются из модуля `widgets/` (см. раздел 6).
- **DeviceMonitoring, CTGAnalysis, TestDashboard, Patients, Settings, Notifications, Reports, AIAnalysis** – отдельные страницы с собственной логикой отображения. (Часть из них заглушки, но структурно выделены.)

## 6. Виджеты (src/widgets)
- `PatientCard`, `HomeCTGMonitor`, `DeviceStatus`, `AlertPanel`, `RecentPatients`, `TrendsChart`, `QuickStats`, `StatusIndicators`, `CTGChart` и др.
- Каждый виджет инкапсулирует визуальное оформление и работу с данными (пока демо-данные).
- Общие стили и константы (например, высота графиков) вынесены в `styles/widgetStyles.ts`.

## 7. Утилиты и сервисы
- `NotificationService`:
  - оборачивает Web Notifications API и Web Audio API (алерты и звуковые сигналы);
  - предоставляет методы `showNotification`, `playAlertSound`, `showAlertNotification` и управление разрешениями.
- `AlertSystem`:
  - содержит набор правил (`ALERT_RULES`) для детекции аномалий КТГ (брадикардия, тахикардия, поздние децелерации и т.д.);
  - поддерживает подписки (`subscribe`), резолвинг алертов и предотвращение дублирования.

## 8. Дизайн-система и стили
- `theme.ts` централизует палитру, токены и настройки компонентов Ant Design.
- Цвета сгруппированы по типам: `primary`, `status`, `chart`, `risk`, оттенки текста и фонов.
- Tailwind используется для утилитарных классов (например, в `AppLayout`, `Hero`).
- Ant Design `ConfigProvider` в `main.tsx` применяет тему ко всему приложению.

## 9. Состояние и данные
- Основное состояние хранится локально через React hooks на уровне страниц или виджетов.
- Глобальное состояние/стор не используется: пока данные имитируются или генерируются локально (например, в дашборде).
- Потенциальное расширение: вынести в Context/Redux/RTK Query при интеграции с реальными API.

## 10. Сборка и деплой
- Vite сборка (`npm run build`) генерирует статический бандл в `dist/`.
- `Dockerfile` (многоступенчатый): Node 20 для сборки → Nginx для раздачи.
- `nginx.conf` обеспечивает SPA fallback и health-check `/healthz`.
- `.dockerignore` исключает кеши и папки разработки.

